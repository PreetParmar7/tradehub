{% extends "base.html" %}
{% block content %}

<div class="max-w-3xl mx-auto py-10 px-6">
    <div class="mb-8">
        <h2 class="text-3xl font-bold text-slate-900">Add New Address</h2>
        <p class="text-slate-500 mt-1">Where should we deliver your order?</p>
    </div>

    <form method="POST" class="bg-white p-8 rounded-2xl shadow-card border border-slate-100 space-y-6">
      {% csrf_token %}

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
              <label class="block text-sm font-semibold text-slate-700 mb-1.5">Full Name</label>
              <input name="full_name" required placeholder="John Doe" 
                     class="w-full border border-slate-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-[#635BFF] focus:border-transparent outline-none transition">
          </div>
          <div>
              <label class="block text-sm font-semibold text-slate-700 mb-1.5">Phone Number</label>
              <input name="phone" required placeholder="+91 98765 43210" 
                     class="w-full border border-slate-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-[#635BFF] focus:border-transparent outline-none transition">
          </div>
      </div>

      <div>
          <label class="block text-sm font-semibold text-slate-700 mb-1.5">Address Line 1</label>
          <input name="address_line1" required placeholder="Street address, P.O. box" 
                 class="w-full border border-slate-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-[#635BFF] focus:border-transparent outline-none transition">
      </div>

      <div>
          <label class="block text-sm font-semibold text-slate-700 mb-1.5">Address Line 2 (Optional)</label>
          <input name="address_line2" placeholder="Apartment, suite, unit, etc." 
                 class="w-full border border-slate-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-[#635BFF] focus:border-transparent outline-none transition">
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div>
              <label class="block text-sm font-semibold text-slate-700 mb-1.5">City</label>
              <input name="city" required placeholder="City" 
                     class="w-full border border-slate-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-[#635BFF] focus:border-transparent outline-none transition">
          </div>
          <div>
              <label class="block text-sm font-semibold text-slate-700 mb-1.5">State</label>
              <select name="state" required class="w-full border border-slate-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-[#635BFF] focus:border-transparent outline-none bg-white transition">
                <option value="">Select State</option>
                {% for code, name in request.user.profile.STATE_CHOICES %}
                  <option value="{{ code }}">{{ name }}</option>
                {% endfor %}
              </select>
          </div>
          <div>
              <label class="block text-sm font-semibold text-slate-700 mb-1.5">Pincode</label>
              <input name="pincode" required placeholder="000000" 
                     class="w-full border border-slate-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-[#635BFF] focus:border-transparent outline-none transition">
          </div>
      </div>

      <input type="hidden" name="latitude" id="lat">
      <input type="hidden" name="longitude" id="lng">

      <div>
          <label class="block text-sm font-semibold text-slate-700 mb-2">Pin Location on Map</label>
          <div id="map" class="w-full h-72 rounded-xl border border-slate-200 overflow-hidden"></div>
          <p class="text-xs text-slate-400 mt-2">Click on the map to set exact location.</p>
      </div>

      <div class="pt-4">
          <button class="w-full bg-[#635BFF] text-white font-bold py-3.5 rounded-xl shadow-lg shadow-indigo-500/20 hover:bg-[#544DDF] hover:-translate-y-0.5 transition duration-200">
            Save Address
          </button>
      </div>
    </form>
</div>

<script>
  function initMap() {
    const map = new google.maps.Map(document.getElementById("map"), {
      center: { lat: 20.5937, lng: 78.9629 },
      zoom: 5,
      disableDefaultUI: true,
      styles: [
          { "featureType": "water", "elementType": "geometry", "stylers": [{ "color": "#e9e9e9" }, { "lightness": 17 }] },
          { "featureType": "landscape", "elementType": "geometry", "stylers": [{ "color": "#f5f5f5" }, { "lightness": 20 }] },
          { "featureType": "road.highway", "elementType": "geometry.fill", "stylers": [{ "color": "#ffffff" }, { "lightness": 17 }] },
          { "featureType": "road.highway", "elementType": "geometry.stroke", "stylers": [{ "color": "#ffffff" }, { "lightness": 29 }, { "weight": 0.2 }] },
          { "featureType": "road.arterial", "elementType": "geometry", "stylers": [{ "color": "#ffffff" }, { "lightness": 18 }] },
          { "featureType": "road.local", "elementType": "geometry", "stylers": [{ "color": "#ffffff" }, { "lightness": 16 }] },
          { "featureType": "poi", "elementType": "geometry", "stylers": [{ "color": "#f5f5f5" }, { "lightness": 21 }] },
          { "featureType": "poi.park", "elementType": "geometry", "stylers": [{ "color": "#dedede" }, { "lightness": 21 }] },
          { "elementType": "labels.text.stroke", "stylers": [{ "visibility": "on" }, { "color": "#ffffff" }, { "lightness": 16 }] },
          { "elementType": "labels.text.fill", "stylers": [{ "saturation": 36 }, { "color": "#333333" }, { "lightness": 40 }] },
          { "elementType": "labels.icon", "stylers": [{ "visibility": "off" }] },
          { "featureType": "transit", "elementType": "geometry", "stylers": [{ "color": "#f2f2f2" }, { "lightness": 19 }] },
          { "featureType": "administrative", "elementType": "geometry.fill", "stylers": [{ "color": "#fefefe" }, { "lightness": 20 }] },
          { "featureType": "administrative", "elementType": "geometry.stroke", "stylers": [{ "color": "#fefefe" }, { "lightness": 17 }, { "weight": 1.2 }] }
      ]
    });

    let marker;

    map.addListener("click", (e) => {
      if (marker) marker.setMap(null);

      marker = new google.maps.Marker({
        position: e.latLng,
        map: map,
        animation: google.maps.Animation.DROP
      });

      document.getElementById("lat").value = e.latLng.lat();
      document.getElementById("lng").value = e.latLng.lng();
    });
  }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&callback=initMap" async defer></script>

{% endblock %}